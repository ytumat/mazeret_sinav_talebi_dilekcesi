<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>DilekÃ§e OluÅŸtur</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Calibri, "Times New Roman", serif;
      background-color: #f4f4f4;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 16px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      margin-right: 10px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    table, th, td {
      border: 1px solid black;
      text-align: center;
      padding: 10px;
    }
    .letter-section {
      display: none;
      margin-top: 40px;
      padding: 40px;
      background: white;
      border: none;
    }
    .center-text {
      text-align: center;
      margin: 0;
      line-height: 1.1;
    }
    .left-text {
      text-align: justify;
      margin-top: 20px;
      white-space: pre-line;
    }
    .download-button {
      display: none;
      margin-top: 20px;
    }
    .ders-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
      background-color: #fafafa;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      .letter-section, .letter-section * {
        visibility: visible;
      }
      .letter-section {
        position: absolute;
        top: 0;
        left: 0;
        width: 210mm;
        height: 297mm;
        background: white !important;
        padding: 40px;
        margin: 0;
        box-shadow: none !important;
        border: none !important;
      }
      .download-button {
        display: none !important;
      }
    }
    .logo-image {
      display: block;
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 20px;
      max-width: 100px;
      height: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Mazeret SÄ±navÄ± Talep DilekÃ§esi OluÅŸturma</h2>
    <form id="dilekceForm">
      <label>AdÄ±nÄ±z:</label>
      <input type="text" id="ad" required />
      <label>SoyadÄ±nÄ±z:</label>
      <input type="text" id="soyad" required />
      <label>Ã–ÄŸrenci NumarasÄ±:</label>
      <input type="text" id="numara" required />
      <label>E-posta:</label>
      <input type="email" id="email" required />
      <label>Cep Telefonu:</label>
      <input type="text" id="telefon" required />
      <label>Mazeretiniz:</label>
      <textarea id="mazeret" rows="3" required></textarea>
      <label>BÃ¶lÃ¼mÃ¼nÃ¼zÃ¼ SeÃ§iniz:</label>
      <select id="bolumSelect" required>
        <option value="MATEMATÄ°K BÃ–LÃœM BAÅžKANLIÄžI'NA">MATEMATÄ°K</option>
        <option value="FÄ°ZÄ°K BÃ–LÃœM BAÅžKANLIÄžI'NA">FÄ°ZÄ°K</option>
        <option value="KÄ°MYA BÃ–LÃœM BAÅžKANLIÄžI'NA">KÄ°MYA</option>
        <option value="Ä°STATÄ°STÄ°K BÃ–LÃœM BAÅžKANLIÄžI'NA">Ä°STATÄ°STÄ°K</option>
        <option value="MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K BÃ–LÃœM BAÅžKANLIÄžI'NA">MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K</option>
        <option value="TÃœRK DÄ°LÄ° VE EDEBÄ°YATI BÃ–LÃœM BAÅžKANLIÄžI'NA">TÃœRK DÄ°LÄ° VE EDEBÄ°YATI</option>
        <option value="BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI BÃ–LÃœM BAÅžKANLIÄžI'NA">BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI</option>
      </select>
      <h3>SÄ±navÄ±na GiremediÄŸim Dersler</h3>
      <div id="dersListesi"></div>
      <button type="button" onclick="dersEkle()">âž• Ders Ekle</button>
      <br><br>
      <button type="submit">DilekÃ§eyi OluÅŸtur</button>
    </form>

    <div class="letter-section" id="dilekceOutput">
    <img src="https://ytumat.github.io/mazeret_sinav_talebi_dilekcesi/logo.png" alt="Ãœniversite Logosu" class="logo-image" />
      <p class="center-text" style="font-weight: bold;">FEN-EDEBÄ°YAT FAKÃœLTESÄ°</p>
      <p id="bolumYazisi" class="center-text" style="font-weight: bold;"></p>
      <p class="center-text" style="font-style: italic;margin-bottom: 1cm;">(Mazeret SÄ±nav Talep Formu)</p>
      <div class="left-text" id="ogrenciBilgileri"></div>
      <p>2025-2026 EÄŸitim-Ã–ÄŸretim yÄ±lÄ± GÃœZ YarÄ±yÄ±lÄ±nda aÅŸaÄŸÄ±da belirtmiÅŸ olduÄŸum mazeretten dolayÄ± Ã¼niversitemiz diÄŸer bÃ¶lÃ¼mlerinden almak istediÄŸim aÅŸaÄŸÄ±daki ders(ler)in Ã¶ÄŸrenci otomasyon sistemine iÅŸlenmesi iÃ§in gereÄŸini arz ederim.</p>
      <p><strong>Mazeret:</strong> <span id="mazeretMetni"></span></p>
      <p style="margin-top: 30px;"><strong>SINAVINA GÄ°REMEDÄ°ÄžÄ°M DERSLER</strong></p>
      <table id="dersTablosu">
        <thead>
          <tr>
            <th>Dersin Kodu</th>
            <th>Dersin AdÄ±</th>
            <th>Grup</th>
            <th>Ã–ÄŸretim Ãœyesi</th>
            <th>SÄ±nav Tarihi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <br><br>
      <p style="text-align: right;" id="tarihYeri"></p>
      <p style="text-align: right;" id="imzaAlani">Ä°mza: _________</p>
    </div>

    <div class="download-button" id="downloadBtnDiv">
      <button id="downloadBtn">ðŸ“¥ PDF Olarak Ä°ndir</button>
    </div>
  </div>

  <script>
    function formatDersAdi(dersAdi) {
      if (!dersAdi) return "";
      const firstThree = dersAdi.slice(0, 3).toUpperCase();
      const rest = dersAdi.slice(3);
      const turkishToLower = (str) =>
        str.replace(/Ä°/g, "i").replace(/I/g, "Ä±")
           .replace(/Åž/g, "ÅŸ").replace(/Äž/g, "ÄŸ")
           .replace(/Ãœ/g, "Ã¼").replace(/Ã–/g, "Ã¶")
           .replace(/Ã‡/g, "Ã§").toLowerCase();
      const capitalizeWords = (str) =>
        str.split(" ").map(k =>
          k.length > 0 ? k[0].toUpperCase() + turkishToLower(k.slice(1)) : ""
        ).join(" ");
      return firstThree + capitalizeWords(rest.trim());
    }

    function dersEkle() {
      const container = document.getElementById("dersListesi");
      const div = document.createElement("div");
      div.className = "ders-item";
      div.innerHTML = `
        <label>Dersin Kodu:</label>
        <input type="text" name="derskod" required />
        <label>Dersin AdÄ±:</label>
        <input type="text" name="dersad" required />
        <label>Dersin Grubu:</label>
        <input type="text" name="dersgrup" required />
        <label>Ã–ÄŸretim Ãœyesi:</label>
        <input type="text" name="dershoca" required />
        <label>SÄ±nav Tarihi:</label>
        <input type="text" name="sÄ±navtarih" required />
      `;
      container.appendChild(div);
    }

    window.onload = () => dersEkle();

    document.getElementById("dilekceForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const ad = document.getElementById("ad").value;
      const soyad = document.getElementById("soyad").value;
      const numara = document.getElementById("numara").value;
      const email = document.getElementById("email").value;
      const telefon = document.getElementById("telefon").value;
      const bolum = document.getElementById("bolumSelect").value;
      const mazeret = document.getElementById("mazeret").value;
      const adSoyad = `${ad}_${soyad}`.replace(/\s+/g, "_");
      window.adSoyad = adSoyad;

      const today = new Date();
      const formattedDate = today.toLocaleDateString("tr-TR");

      const bilgiler = `<strong>Ad Soyad:</strong> ${ad} ${soyad}<br>
<strong>Ã–ÄŸrenci No:</strong> ${numara}<br>
<strong>E-posta:</strong> ${email}<br>
<strong>Telefon:</strong> ${telefon}<br><div style="margin-bottom:2cm;"></div>`;
      document.getElementById("ogrenciBilgileri").innerHTML = bilgiler;
      document.getElementById("bolumYazisi").innerText = bolum;
      document.getElementById("tarihYeri").innerText = `Tarih: ${formattedDate}`;
      document.getElementById("mazeretMetni").innerText = mazeret;

      const tbody = document.querySelector("#dersTablosu tbody");
      tbody.innerHTML = "";

      const dersler = document.querySelectorAll(".ders-item");
      dersler.forEach((ders) => {
        const kod = ders.querySelector("input[name='derskod']").value;
        const ad = formatDersAdi(ders.querySelector("input[name='dersad']").value);
        const grup = ders.querySelector("input[name='dersgrup']").value;
        const hoca = ders.querySelector("input[name='dershoca']").value;
        const tarih = ders.querySelector("input[name='sÄ±navtarih']").value;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${kod}</td>
          <td>${ad}</td>
          <td>${grup}</td>
          <td>${hoca}</td>
          <td>${tarih}</td>
        `;
        tbody.appendChild(row);
      });

      document.getElementById("dilekceOutput").style.display = "block";
      document.getElementById("downloadBtnDiv").style.display = "block";
    });

    document.getElementById("downloadBtn").addEventListener("click", function () {
      const img = document.querySelector(".logo-image");

      if (!img.complete) {
        img.onload = () => startPdf();
        img.onerror = () => startPdf();
      } else {
        startPdf();
      }

      function startPdf() {
        const element = document.getElementById("dilekceOutput");
        const opt = {
          margin: 0.5,
          filename: `${window.adSoyad}_dilekce.pdf`,
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: { scale: 2, useCORS: true, allowTaint: true },
          jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
        };
        html2pdf().set(opt).from(element).save();
      }
    });
  </script>
</body>
</html>
