<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>DilekÃ§e OluÅŸtur</title>
  <style>
    body {
      font-family: Calibri, "Times New Roman", serif;
      background-color: #f4f4f4;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      width: 95%;           /* Mobil ekranlarda kenarlardan taÅŸmayÄ± engeller */
      margin: auto;
      background: white;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 16px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      margin-right: 10px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    table, th, td {
      border: 1px solid black;
      text-align: center;
      padding: 10px;
    }
    .letter-section {
      display: none;
      margin-top: 40px;
      padding: 40px;
      background: white;
      border: none;
    }
    .center-text {
      text-align: center;
      margin: 0;
      line-height: 1.1;
    }
    .left-text {
      text-align: justify;
      margin-top: 20px;
      white-space: pre-line;
    }
    .download-button {
      display: none;
      margin-top: 20px;
    }
    .ders-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
      background-color: #fafafa;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      .letter-section, .letter-section * {
        visibility: visible;
      }
      .letter-section {
        position: absolute;
        top: 0;
        left: 0;
        width: 210mm;
        height: 297mm;
        background: white !important;
        padding: 40px;
        margin: 0;
        box-shadow: none !important;
        border: none !important;
      }
      .download-button {
        display: none !important;
      }
    }
    .logo-image {
      display: block;
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 20px;
      max-width: 80px;
      height: auto;
    }

.tarih-sag {
  text-align: right;
  margin: 0;
  font-size: 16px;
}
#tarihYeri,
#imzaAlani {
  display: none;
}

.alt-kisim {
  display: flex;
  justify-content: space-between;
  gap: 20px; /* Ä°ki kolon arasÄ± boÅŸluk */
  margin-top: 30px;
}

.sol-metni {
  flex: 1;
  max-width: 50%;
  font-size: 16px;
  line-height: 1.4;
}

.sag-tablo {
  flex: 1;
  max-width: 50%;
}

.sag-tablo table {
  width: 100%; /* tabloyu kapsayÄ±cÄ±ya yay */
  border-collapse: collapse;
}

.sag-tablo td {
  border: 1px solid black;
  padding: 10px;
  height: 100px;
  /* width kaldÄ±rÄ±ldÄ±, Ã§Ã¼nkÃ¼ flex dÃ¼zenlemesi var */
}
#dersTablosu td {
  height: 5px; /* Ä°stediÄŸin dÃ¼ÅŸÃ¼k deÄŸeri buraya yaz */
  padding: 3px 10px; /* Dilersen padding ile de oynayabilirsin */
}

@media (max-width: 768px) {
  .alt-kisim {
    flex-direction: column;     /* Ä°ki kolon Ã¼st Ã¼ste gelsin */
  }
  .sol-metni, .sag-tablo {
    max-width: 100%;
  }
  .logo-image {
    max-width: 60px;           /* KÃ¼Ã§Ã¼k ekranda logo daha ufak */
  }
  button {
    width: 100%;               /* Butonlar ekrana otursun */
    margin-top: 10px;
  }
}
/* TÃ¼m tablolar iÃ§in */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 30px;
}

/* Sadece geniÅŸ tablo iÃ§eriÄŸi iÃ§in yatay kaydÄ±rma */
.table-wrapper {
  width: 100%;
  overflow-x: auto; /* Mobilde yatay kaydÄ±rma aktif olur */
}

    /* --- PDF Ã§Ä±ktÄ±sÄ± iÃ§in tam A4 boyutunda sabit alan --- */
.letter-section {
  width: 794px;             /* A4 geniÅŸliÄŸi (96 DPI'ya gÃ¶re) */
  min-height: 1123px;       /* A4 yÃ¼ksekliÄŸi */
  margin: 0 auto;           /* Ortala */
  background: white;
  padding: 40px;
  box-sizing: border-box;
}

/* Sayfa sonuna yakÄ±n iÃ§eriklerin bÃ¶lÃ¼nmesini engeller */
.alt-kisim,
#gerekceTablosu,
#dersTablosu {
  page-break-inside: avoid;
}


    
  </style>
</head>
<body>
  <div class="container">
    <h2>Mazeret SÄ±navÄ± Talep DilekÃ§esi OluÅŸturma</h2>
    <form id="dilekceForm">
      <label>AdÄ±nÄ±z:</label>
      <input type="text" id="ad" required />
      <label>SoyadÄ±nÄ±z:</label>
      <input type="text" id="soyad" required />
      <label>Ã–ÄŸrenci NumarasÄ±:</label>
      <input type="text" id="numara" required />
      
<label>YTÃœ E-posta KullanÄ±cÄ± AdÄ±nÄ±z:</label>
<div style="display: flex; align-items: center;">
  <input type="text" id="emailUser" required pattern="^[^@]+$" placeholder="kullaniciadi" style="flex: 1;" />
  <span style="margin-left: 5px;">@std.yildiz.edu.tr</span>
</div>



      <label>Cep Telefonu:</label>
      <input type="text" id="telefon" required />
      <label>Mazeretiniz:</label>
      <textarea id="mazeret" rows="3" required></textarea>
      <label>BÃ¶lÃ¼mÃ¼nÃ¼zÃ¼ SeÃ§iniz:</label>
      <select id="bolumSelect" required>
        <option value="MATEMATÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">MATEMATÄ°K</option>
        <option value="FÄ°ZÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">FÄ°ZÄ°K</option>
        <option value="KÄ°MYA BÃ–LÃœM BAÅžKANLIÄžINA">KÄ°MYA</option>
        <option value="Ä°STATÄ°STÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">Ä°STATÄ°STÄ°K</option>
        <option value="MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K</option>
        <option value="TÃœRK DÄ°LÄ° VE EDEBÄ°YATI BÃ–LÃœM BAÅžKANLIÄžINA">TÃœRK DÄ°LÄ° VE EDEBÄ°YATI</option>
        <option value="BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI BÃ–LÃœM BAÅžKANLIÄžINA">BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI</option>
      </select>
      <h3>SÄ±navÄ±na GiremediÄŸim Dersler</h3>
      <div id="dersListesi"></div>
      <button type="button" onclick="dersEkle()">âž• Ders Ekle</button>
      <br><br>
      <button type="submit">DilekÃ§eyi OluÅŸtur</button>
    </form>

    <div class="letter-section" id="dilekceOutput">
      <img src="https://ytumat.github.io/mazeret_sinav_talebi_dilekcesi/logo.png" alt="Ãœniversite Logosu" class="logo-image" crossorigin="anonymous" />
<!-- ðŸ”½ Tarih iÃ§in yeni paragraf -->
<p class="tarih-sag" id="ustTarihYazisi"></p><br>
      <p class="center-text" style="font-weight: bold;">FEN-EDEBÄ°YAT FAKÃœLTESÄ°</p>
      <p id="bolumYazisi" class="center-text" style="font-weight: bold;"></p>
      <p class="center-text" style="font-style: italic;margin-bottom: 1cm;">(Mazeret SÄ±nav Talep Formu)</p>

 <p> BÃ¶lÃ¼mÃ¼nÃ¼z <strong><span id="numaraYazisi"></span></strong> numaralÄ± Ã¶ÄŸrencisiyim. Ekte sunulan mazeretim nedeniyle aÅŸaÄŸÄ±da belirttiÄŸim derslerin ara sÄ±navÄ±na giremedim. AdÄ± geÃ§en derslerden Mazeret sÄ±navÄ±na girmek istiyorum.<br><br>
GereÄŸini saygÄ±larÄ±mla arz ederim.   
</p>
<p id="adSoyadYazisi" style="text-align: right; margin-top: 40px;"></p>
<p id="epostaAltMetin" style="text-align: center; margin-top: 40px; color:red; font-style: italic;"></p>
<p id="telefonYazisi" style="text-align: left; margin-top: 10px;"></p>
<p id="emailYazisi" style="text-align: left; margin-top: 2px;"></p>
<br>
<div style="text-align:left; margin-top:10px;">
          <span style="display:inline-block; width:18px; height:18px; border:1.5px solid black; text-align:center; line-height:18px; font-weight:bold; margin-right:8px;">âœ—</span>
          Mazeretli olduÄŸum gÃ¼nlere rastlayan diÄŸer derslerimin de sÄ±navÄ±na girmediÄŸimi beyan ederim.
        </div>
<div class="table-wrapper">
<table id="gerekceTablosu" style="margin-top: 30px; width: 100%; border-collapse: collapse;">
  <thead>
    <tr>
    <th style="text-align: justify; border: 1px solid black; padding: 10px; min-height: 150px;">
  <span style="font-weight: bold;">GerekÃ§e:</span>
  <span id="mazeretMetni" style="font-weight: normal;"></span>
</th>
    </tr>
  </thead>
</table>
</div>




   <div class="left-text" id="ogrenciBilgileri"></div>
     
     
   <p style="margin-top: 30px; text-align: center;"><strong>SINAVINA GÄ°REMEDÄ°ÄžÄ°M DERSLER</strong></p>
    <div class="table-wrapper">
      <table id="dersTablosu">
        <thead>
          <tr>
            <th>DERSÄ°N KODU</th>
            <th>DERSÄ°N ADI</th>
            <th>GRUP</th>
            <th>Ã–ÄžRETÄ°M ÃœYESÄ°</th>
            <th>SINAV TARÄ°HÄ°</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
      
    <div class="alt-kisim">
  <div class="sol-metni">
    <p><br><strong>Ek:</strong> Mazeretini ispatlayan belge, sÄ±nav programÄ±, transkript.<br><strong>Not:</strong><br>Raporlu bulunan tarihlerde sÄ±nava girdiÄŸi tespit edilen Ã¶ÄŸrencilerin sÄ±navlarÄ± iptal edilecektir. Ä°ptal edilen sÄ±navlarÄ±n mazeretleri yapÄ±lmayacaktÄ±r.</p>
  </div>
  <div class="sag-tablo">
    <table>
      <tr>
        <td style="border: 1px solid black; padding: 10px; height: 100px;">Ã–ÄŸrencinin mazereti uygundur / uygun deÄŸildir.<br><br><br>BÃ¶lÃ¼m BaÅŸkanÄ±</td>
      </tr>
    </table>
  </div>
</div>



 <p style="text-align: right;" id="tarihYeri"></p>
<p style="text-align: right;" id="imzaAlani">Ä°mza: _________</p>



    <div class="download-button" id="downloadBtnDiv">
      <button id="downloadBtn">ðŸ“¥ PDF Olarak Ä°ndir</button>
    </div>
  </div>

  <!-- jsPDF ve html2canvas kÃ¼tÃ¼phaneleri -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
   function formatDersAdi(dersAdi) {
  if (!dersAdi) return "";
  
  const turkishToLower = (str) =>
    str.replace(/Ä°/g, "i").replace(/I/g, "Ä±")
       .replace(/Åž/g, "ÅŸ").replace(/Äž/g, "ÄŸ")
       .replace(/Ãœ/g, "Ã¼").replace(/Ã–/g, "Ã¶")
       .replace(/Ã‡/g, "Ã§").toLowerCase();

  const turkishCapitalize = (str) =>
    str.charAt(0).toLocaleUpperCase("tr-TR") + turkishToLower(str.slice(1));

  return dersAdi
    .split(" ")
    .map(kelime => turkishCapitalize(kelime))
    .join(" ");
}


function formatDersKodu(kod) {
  if (!kod) return "";
  const firstThree = kod.slice(0, 3).toUpperCase();
  const rest = kod.slice(3).toLowerCase();
  return firstThree + rest;
}


    function dersEkle() {
      const container = document.getElementById("dersListesi");
      const div = document.createElement("div");
      div.className = "ders-item";
      div.innerHTML = `
        <label>Dersin Kodu:</label>
        <input type="text" name="derskod" required />
        <label>Dersin AdÄ±:</label>
        <input type="text" name="dersad" required />
        <label>Dersin Grubu:</label>
        <input type="text" name="dersgrup" required />
        <label>Ã–ÄŸretim Ãœyesi:</label>
        <input type="text" name="dershoca" required />
        <label>SÄ±nav Tarihi:</label>
       <input type="text" name="sÄ±navtarih" required placeholder="gg.aa.yyyy" />


      `;
      container.appendChild(div);
    }

    window.onload = () => dersEkle();

    document.getElementById("dilekceForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const ad = document.getElementById("ad").value;
      const soyad = document.getElementById("soyad").value;
      const numara = document.getElementById("numara").value;
      
      const telefon = document.getElementById("telefon").value;
      const bolum = document.getElementById("bolumSelect").value;
      const mazeret = document.getElementById("mazeret").value;
      const adSoyad = `${ad}_${soyad}`.replace(/\s+/g, "_");
      window.adSoyad = adSoyad;

const emailUser = document.getElementById("emailUser").value.trim();
const email = `${emailUser}@std.yildiz.edu.tr`;

document.getElementById("epostaAltMetin").innerText = `Bu belge ${email} adresinden bÃ¶lÃ¼me iletilmiÅŸtir.`;


      const today = new Date();
      const formattedDate = today.toLocaleDateString("tr-TR");
document.getElementById("ustTarihYazisi").innerText = `Tarih: ${formattedDate}`;


      const bilgiler = `<strong>Ad Soyad:</strong> ${ad} ${soyad}<br>
<strong>Ã–ÄŸrenci No:</strong> ${numara}<br>
<strong>E-posta:</strong> ${email}<br>
<strong>Telefon:</strong> ${telefon}<br><div style="margin-bottom:2cm;"></div>`;
     
      document.getElementById("bolumYazisi").innerText = bolum;
      document.getElementById("tarihYeri").innerText = `Tarih: ${formattedDate}`;
      document.getElementById("mazeretMetni").innerText = mazeret;
      document.getElementById("numaraYazisi").innerText = numara;
document.getElementById("ustTarihYazisi").innerText = `Tarih: ${formattedDate}`;
document.getElementById("adSoyadYazisi").innerHTML = `<strong>AdÄ±-SoyadÄ±:</strong> ${ad} ${soyad}`;
document.getElementById("telefonYazisi").innerHTML = `Cep Tel No: ${telefon}`;
document.getElementById("emailYazisi").innerHTML = `E-posta: ${email}`;



      const tbody = document.querySelector("#dersTablosu tbody");
      tbody.innerHTML = "";

      const dersler = document.querySelectorAll(".ders-item");
      dersler.forEach((ders) => {
       const kodRaw = ders.querySelector("input[name='derskod']").value;
const kod = formatDersKodu(kodRaw);

        const ad = formatDersAdi(ders.querySelector("input[name='dersad']").value);
        const grup = ders.querySelector("input[name='dersgrup']").value;
        const hoca = ders.querySelector("input[name='dershoca']").value;
        const tarih = ders.querySelector("input[name='sÄ±navtarih']").value;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${kod}</td>
          <td>${ad}</td>
          <td>${grup}</td>
          <td>${hoca}</td>
          <td>${tarih}</td>
        `;
        tbody.appendChild(row);
      });

      document.getElementById("dilekceOutput").style.display = "block";
      document.getElementById("downloadBtnDiv").style.display = "block";
    });

    document.getElementById("downloadBtn").addEventListener("click", function () {
  const img = document.querySelector(".logo-image");
  const downloadBtnDiv = document.getElementById("downloadBtnDiv");

  // Butonu gizle
  downloadBtnDiv.style.visibility = "hidden";

  if (!img.complete) {
    img.onload = () => startPdf();
    img.onerror = () => {
      alert("Logo yÃ¼klenemedi!");
      startPdf();
    };
  } else {
    startPdf();
  }

  function startPdf() {
    const element = document.getElementById("dilekceOutput");

   html2canvas(element, {
  scale: 3,
  useCORS: true,
  logging: false
}).then(canvas => {
  const imgData = canvas.toDataURL("image/jpeg", 0.9);

  const pdf = new window.jspdf.jsPDF({
    unit: "mm",
    format: "a4",
    orientation: "portrait"
  });

  const pdfWidth = pdf.internal.pageSize.getWidth();
  const pdfHeight = pdf.internal.pageSize.getHeight();
  const imgWidth = pdfWidth;
  const imgHeight = (canvas.height * imgWidth) / canvas.width;

   let position = 0;
  let heightLeft = imgHeight;

  pdf.addImage(imgData, "JPEG", 0, position, imgWidth, imgHeight);
  heightLeft -= pdfHeight;

  while (heightLeft > 0) {
    position = heightLeft - imgHeight;
    pdf.addPage();
    pdf.addImage(imgData, "JPEG", 0, position, imgWidth, imgHeight);
    heightLeft -= pdfHeight;
  }


  pdf.setFont("helvetica", "italic");
  pdf.setFontSize(8);
  pdf.setTextColor(150);
  pdf.text("(Form No: FR-0607; Revizyon Tarihi:14.01.2014; Revizyon No: 00)", 10, 290);

  pdf.save(`${window.adSoyad || "dilekce"}.pdf`);
  downloadBtnDiv.style.visibility = "visible";
});

  }
});

  </script>
</body>
</html>








